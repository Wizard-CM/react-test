var q=Object.defineProperty;var W=(t,a,r)=>a in t?q(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r;var f=(t,a,r)=>W(t,typeof a!="symbol"?a+"":a,r);import{b as A,D as z,c as m,I as O,Q as B,r as n,u as M,d as Q,e as Y,s as h,j as e,a as R,C as T,p as G,L as H}from"./index-yag6wL5M.js";import{u as J}from"./index.esm-BOc36_KT.js";import{B as C}from"./Button-j7ZomHxx.js";import{m as v,L as K}from"./data-2_J9rPiU.js";class U{constructor(){f(this,"client",new A);f(this,"databases");this.client.setEndpoint("https://cloud.appwrite.io/v1").setProject("67063d5c0003cd312df2"),this.databases=new z(this.client)}async createComment({commentator:a,comment:r,postId:i}){try{return await this.databases.createDocument(m.appWriteDatabaseId,m.appWriteCommentCollectionId,O.unique(),{commentator:a,comment:r,postId:i})}catch(d){return console.log(d),d}}async getCommentsOfPost(a){try{return await this.databases.listDocuments(m.appWriteDatabaseId,m.appWriteCommentCollectionId,[B.equal("postId",a)])}catch(r){return console.log(r),r}}async likePost({postId:a,likes:r}){try{await this.databases.updateDocument(m.appWriteDatabaseId,m.appWriteCollectionId,a,{likes:r})}catch{}}}const g=new U,se=()=>{var y,w;const[t,a]=n.useState(null),[r,i]=n.useState([]),[d,j]=n.useState(null),[D,I]=n.useState(!0),{slug:c}=M(),x=Q(),{register:b,handleSubmit:k,watch:V,formState:{errors:u},reset:S}=J(),o=new Date(t==null?void 0:t.$createdAt),N=Y(s=>s.auth.userData),P=t&&N?t.userId===N.$id:!1;n.useEffect(()=>{c?h.getSinglePost(c).then(s=>{s?(a(s),j(s.likes),I(!1)):x("/")}):x("/")},[c,x]),n.useEffect(()=>{g.getCommentsOfPost(c).then(s=>{r.length!=s.documents.length&&i(s.documents)})},[r]);const F=s=>{const p={commentator:s.commentator,comment:s.comment,postId:c};g.createComment(p).then(l=>{i($=>[...$,{commentator:s.commentator,comment:s.comment,postId:c,$createdAt:new Date}])}),S({commentator:"",comment:""})},L=()=>{h.deletePost(t.$id).then(s=>{s&&(h.deleteFile(t.featuredImage),x("/"))})},E=()=>{j(s=>s+1),g.likePost({postId:c,likes:d+1})};return D?e.jsx(R,{}):t?e.jsx("div",{className:"py-8 w-full",children:e.jsxs(T,{children:[e.jsxs("div",{className:"w-full flex flex-col md:flex-row gap-5 border-b-[1px] border-gray-900 pb-4",children:[e.jsx("div",{className:"left w-full md:w-[40%]",children:e.jsx("img",{src:h.getFilePreview(t==null?void 0:t.featuredImage),alt:t.title,className:"rounded-xl min-w-[300px] w-full h-[400px] object-cover"})}),e.jsxs("div",{className:"right w-full md:w-[55%] text-center md:text-start",children:[e.jsxs("div",{className:"flex gap-3 font-mono w-full justify-center md:justify-start",children:[e.jsxs("p",{className:"text-[0.8rem] capitalize",children:["Author : ",t.userName]}),e.jsxs("p",{className:"text-[0.8rem]",children:[v[o==null?void 0:o.getMonth()]," ",o==null?void 0:o.getDate(),",",o==null?void 0:o.getFullYear()]})]}),e.jsx("h3",{className:"text-4xl md:text-5xl lg:text-6xl font-serif mb-3",children:t.title}),e.jsx("span",{className:"browser-css text-gray-700",children:G(t.content)}),e.jsxs("div",{className:"flex items-center gap-4 w-full justify-center md:justify-start",children:[e.jsx("button",{className:"my-2 px-2 bg-[#F0F0F0] border-[1px] text-[0.9rem] font-serif rounded-lg capitalize text-blue-600",children:t.category}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{}),e.jsx("p",{className:" px-1  text-[0.7rem]  font-bold",children:d})]})]}),P&&e.jsxs("div",{className:"my-3",children:[e.jsx(H,{to:`/edit-post/${t.$id}`,children:e.jsx(C,{className:"mr-3 bg-green-600",children:"Edit"})}),e.jsx(C,{className:"bg-red-600",onClick:L,children:"Delete"})]}),e.jsx("button",{onClick:E,className:"mr-3 px-5 py-2 rounded-md border-2 border-gray-900",children:"Like"})]})]}),e.jsx("h3",{className:"text-5xl font-serif my-9 text-center",children:"Comments Section"}),e.jsxs("div",{className:"flex gap-5 flex-col md:flex-row",children:[e.jsx("div",{className:"left w-full md:w-[40%] md:border-r-[1px]  pr-4 border-gray-900 ",children:e.jsxs("form",{onSubmit:k(F),className:"flex flex-col w-full mt-4 gap-3",children:[e.jsx("input",{placeholder:"Enter Commentator Name..",className:"border-[2px] px-3 py-2",...b("commentator",{required:"Name of commentator is required"})}),u.commentator&&e.jsx("p",{className:"text-red-600 text-[0.8rem] m-0",role:"alert",children:(y=u.commentator)==null?void 0:y.message}),e.jsx("textarea",{placeholder:"Comment...",rows:10,className:"border-[2px] px-3 py-2",...b("comment",{required:"Comment is required"})}),u.comment&&e.jsx("p",{className:"text-red-600 text-[0.8rem] m-0",role:"alert",children:(w=u.comment)==null?void 0:w.message}),e.jsx("button",{className:"bg-gray-900 text-white py-2 rounded-md",children:"Create Comment"})]})}),e.jsx("div",{className:"right  w-full md:w-[55%] ",children:r.length>0?r.map((s,p)=>{const l=new Date(s.$createdAt);return e.jsxs("div",{className:"border-b-[1px] border-gray-300 p-3",children:[e.jsxs("div",{className:"flex gap-3 font-mono",children:[e.jsx("p",{className:"text-[0.7rem] capitalize",children:s.commentator}),e.jsxs("p",{className:"text-[0.7rem]",children:[v[l==null?void 0:l.getMonth()]," ",l==null?void 0:l.getDate(),",",l==null?void 0:l.getFullYear()]})]}),e.jsx("h4",{className:"text-xl",children:s.comment})]},p)}):e.jsx("h3",{className:"text-3xl text-center w-full mt-10",children:"No Comments To Show"})})]})]})}):null};export{se as default};
